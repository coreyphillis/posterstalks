---
title       : Communities, networks, & visualizations in R
date        : 2013-07-31
author      : Scott Chamberlain
job         : 
framework   : io2012        # {io2012, html5slides, shower, dzslides, ...}
highlighter : highlight.js  # {highlight.js, prettify, highlight}
hitheme     : tomorrow      # 
widgets     : []            # {mathjax, quiz, bootstrap}
mode        : selfcontained # {standalone, draft}
assets      :
  css: "http://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css"
---

## The plan

+ General visualizations
+ Community ecology: analyses and viz
+ Networks/graphs: analyses and viz

---

## Lets have some fun first - visualizations

```{r viz1, eval=FALSE, echo=TRUE}
install.packages("ggplot2")
```

```{r viz2, cache=TRUE, fig.height=5.5, tidy=FALSE, fig.align='center'}
library(ggplot2)
ggplot(data=iris, aes(Sepal.Length, Sepal.Width, colour=Species)) +
  geom_point() + 
  scale_color_manual(values = c("#FF0000", "#0000FF", "#00FF00"))
```

---

## Terminology

+ ggplot - The main function where you specify the dataset and variables to plot
+ geom - geometric objects
  + `geom_point()`, `geom_bar()`, `geom_density()`, `geom_line()`, `geom_area()`
+ aes - aesthetics
  + shape, alpha (transparency), color, fill, linetype
+ scale - Define how your data will be plotted
  + continuous, discrete, log

---

## Building blocks, mix and match

```{r buildup1, eval=FALSE, cache=TRUE, tidy=FALSE, fig.align='center'}
ggplot(data=iris, aes(Sepal.Length, Sepal.Width, colour=Species)) +
  geom_point()
```

OR, just do 

```{r buildup2, eval=FALSE, cache=TRUE, tidy=FALSE, fig.align='center'}
p <- ggplot(data=iris, aes(Sepal.Length, Sepal.Width, colour=Species))
p + geom_point()
```

---

## Color by species

```{r color1, cache=TRUE, fig.height=5.5, tidy=FALSE, fig.align='center'}
ggplot(data=iris, aes(Sepal.Length, Sepal.Width, colour=Species)) +
  geom_point()
```

--- &twocol

## Adjust the size (and color) of points

*** =left

```{r size1, cache=TRUE, fig.height=5.5, tidy=FALSE, fig.align='center'}
ggplot(data=iris, aes(Sepal.Length, Sepal.Width, colour=Species)) +
  geom_point(size = 6)
```

*** =right

```{r size2, cache=TRUE, fig.height=5.5, tidy=FALSE, fig.align='center'}
ggplot(data=iris, aes(Sepal.Length, Sepal.Width, color=Species, size=Species)) +
  geom_point()
```

---

## Facet by species

```{r viz4, cache=TRUE, fig.height=5.5, tidy=FALSE, fig.align='center'}
ggplot(data=iris, aes(Sepal.Length, Sepal.Width)) +
  geom_point() +
  facet_wrap(~ Species)
```

--- &twocol

## Combine geoms

*** =left

### Combine `geom_boxplot` and `geom_point`

```{r combinegeoms1, cache=TRUE, fig.height=5.5, tidy=FALSE, fig.align='center'}
ggplot(data=iris, aes(Species, Petal.Width)) +
  geom_boxplot() +
  geom_point()
```

*** =right

### Order matters! 

```{r combinegeoms2, cache=TRUE, fig.height=5.5, tidy=FALSE, fig.align='center'}
ggplot(data=iris, aes(Species, Petal.Width)) +
  geom_point() +
  geom_boxplot()
```

---

## Make this plot

```{r makethis, cache=TRUE, echo=FALSE, fig.height=7, fig.width=10, tidy=FALSE, fig.align='center', message=FALSE}
ggplot(data=iris, aes(Petal.Width, fill=Species)) +
  geom_histogram() +
  facet_wrap(~ Species) +
  theme_grey(base_size=20)
```

--- 

## Saving plots using ggplot2

If the plot is on your screen
```{r saveggplot1, eval = FALSE}
ggsave('~/path/to/figure/filename.png')
```

If your plot is assigned to an object
```{r saveggplot2, eval = FALSE}
ggsave(plot1, file = "~/path/to/figure/filename.png")
```

Specify a size
```{r saveggplot3, eval = FALSE}
ggsave(file = "/path/to/figure/filename.png", width = 6,
height =4)
```

Or any format (pdf, png, eps, svg, jpg)
```{r saveggplot4, eval = FALSE}
ggsave(file = "/path/to/figure/filename.eps")
ggsave(file = "/path/to/figure/filename.jpg")
ggsave(file = "/path/to/figure/filename.pdf")
```

<!-- community structure -->
<!-- community structure -->
<!-- community structure -->

--- 

## Community structure

+ Diversity indices
+ Rarefaction - comparing diverity in different samples
+ Ordination

--- &twocol align1:left

## Diversity indices

*** =left

Shannon-Weaver

```{r diversity1, comment=NA, cache=TRUE}
library(vegan)
data(BCI)
bci_subset <- BCI[1:3,]
head(bci_subset)[,10:11]
(H <- diversity(bci_subset))
```

*** =right

Simpson

```{r diversity2, comment=NA, cache=TRUE}
diversity(bci_subset, index="simpson")
```

Evenness

```{r diversity4, comment=NA, cache=TRUE}
H <- diversity(bci_subset)
H/log(specnumber(bci_subset))
```

---

## Rarefaction

```{r rarefaction1, cache=TRUE, comment=NA, fig.height=5.5, fig.align='center'}
nosp <- specnumber(BCI)
nosp_rare <- rarefy(BCI, raremax)
df <- data.frame(nosp, nosp_rare)
head(df)
```

---

## Make this plot

```{r rarefaction2, echo=FALSE, cache=TRUE, comment=NA, fig.height=7, fig.width=10, fig.align='center', warning=FALSE}
ggplot(df, aes(nosp, nosp_rare)) +
  geom_point(size=4) +
  theme_grey(base_size=20) +
  scale_x_continuous(limits=c(70,110)) +
  scale_y_continuous(limits=c(70,110))
```

--- &twocol

## Rarefaction curves

*** =left 

```{r rarefaction3, cache=TRUE, comment=NA, fig.height=5.5, fig.align='center'}
raremax <- min(rowSums(BCI))
rarecurve(BCI, step = 20, sample = raremax, col = "blue", cex = 0.6)
```

*** =right

```{r rarefaction4, cache=TRUE, comment=NA, fig.height=5.5, fig.align='center', warning=FALSE}
data(BCI)
sp1 <- specaccum(BCI)
sp2 <- specaccum(BCI, "random")
sp2
summary(sp2)
plot(sp1, ci.type="poly", col="blue", lwd=2, ci.lty=0, ci.col="lightblue")
boxplot(sp2, col="yellow", add=TRUE, pch="+")
```

--- &twocol

## Ordination

*** =left

```{r ordinationbase, cache=TRUE, comment=NA, fig.height=5.5, fig.align='center'}
data(dune)
ord <- metaMDS(dune)
plot(ord)
```

*** =right

```{r ordinationggplot, cache=TRUE, comment=NA, fig.height=5.5, fig.align='center'}
ord_axes <- data.frame(scores(ord))
ord_spp <- data.frame(scores(ord, display="species"))
ggplot(ord_axes, aes(NMDS1, NMDS2)) +
  geom_point() +
  geom_point(data=ord_spp, aes(NMDS1, NMDS2), colour="red")
```

---

```{r asdf, cache=TRUE, comment=NA, fig.height=5.5, fig.align='center'}
plot(ord)
```

<!-- networks -->

--- 

## Networks

+ ad
+ ad
+ ad

---